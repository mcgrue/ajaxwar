<!DOCTYPE HTML>
<html>
<head>
    <title>Ajaxwar: 1982</title>

    <!-- straight out of the jquery "download everything" page... -->
    <link type="text/css" href="css/ui-lightness/jquery-ui-1.8.4.custom.css" rel="stylesheet" />	
    <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script> 
    <script type="text/javascript" src="js/jquery-ui-1.8.4.custom.min.js"></script> 
    
    <!-- move me later -->
    <style>
        #playingfield {
            width: 1000px;
            height: 500px;
            background-color: #DDD;
            position: relative;
        }
        
        .tank {
            width: 60px;
            height: 30px;
            background-image: url(i/tank.png);
            
            position: absolute;
        }
        
        .production {
            width: 60px;
            height: 60px;
            background-image: url(i/production.png);
            
            position: absolute;
        }
        
        .tower {
            width: 60px;
            height: 60px;
            background-image: url(i/turret.png);
            
            position: absolute;
        }
        
        #button_indicator {
            position: absolute;
            top: 0px;
            right: 0px;
            width: 320px;
        }
        
        .indicator {
            border: solid 4px white;
            position: relative;
            display: inline-block;
            margin: 6px;
            background-repeat: none;
        }
        
    </style>
    
    <script type="text/javascript">
    
        if( typeof AjaxWar == 'undefined' ) {
            AjaxWar = {};
        } else {
            throw "Ajaxwar was already defined.  Someone probably did bad copy/pasting.";
        }
        
        AjaxWar._objRefs = [];

        AjaxWar.getNextRef = function () {
            return 'ajxwr_' + AjaxWar._objRefs.length;
        }
        
        AjaxWar.addRef = function (ref) {
            AjaxWar._objRefs.push(ref);
        }
        
        AjaxWar.util = {};
        AjaxWar.ui = {};
    
        AjaxWar.util.relPosition = function (element, mouseX, mouseY) {
            var offset = $(element).offset();
            var x = mouseX - offset.left;
            var y = mouseY - offset.top;
            
            return {'x': parseInt(x), 'y': parseInt(y)};
        }
        
        AjaxWar.util.inArray = function (haystack, needle) {
            var i;
            for (i=0; i < haystack.length; i++) {
                if (haystack[i] === needle) {
                     return true;
                }
            }
            return false;
        };
        
        AjaxWar.ui.indicator = {};
        AjaxWar.ui.indicator.clearIndicator = function() {
            $('#tank_indicator').css('border', 'solid 4px white');
            $('#production_indicator').css('border', 'solid 4px white');
            $('#tower_indicator').css('border', 'solid 4px white');
        }
        
        AjaxWar.ui.indicator.cursor = false;
        
        AjaxWar.ui.indicator.keyMappings = {
            '1' : 'tank',
            '2' : 'production',
            '3' : 'tower'
        };
        
        AjaxWar.ui.indicator.isValid = function() {
            return AjaxWar.util.inArray(AjaxWar.ui.indicator.keyMappings, AjaxWar.ui.indicator.cursor);
        }
        
        $(function(){
            
            $(document).keypress(function (eh){
                var key = String.fromCharCode(eh.charCode);
                
                var map = AjaxWar.ui.indicator.keyMappings[key];
                
                if( map ) {
                    AjaxWar.ui.indicator.clearIndicator();
                    
                    $('#'+map+'_indicator').css('border', 'solid 4px red');
                    AjaxWar.ui.indicator.cursor = map;
                }
            });
            
            $('#playingfield').click(function(e){
                
                if( !AjaxWar.ui.indicator.isValid() ) {
                    return;
                }
                
                var div = $("<div>").html("");
                
                mousePos = AjaxWar.util.relPosition("#playingfield", e.pageX, e.pageY);
                
                div.addClass('production');
                
                div.css( 'left', mousePos.x + 'px' );
                div.css( 'top', mousePos.y + 'px' );
                
                var id = AjaxWar.getNextRef();
                div.attr('id', id);
                AjaxWar.addRef(id);
                
                div.draggable();
                
                $("#playingfield").prepend(div);
                
                $('#'+id).click(function(e) {
                    return false;
                });
                
                return false;
            });
            
        });
    </script>
    
</head>
<body>
    <h1>Ajaxwar: 1982</h1>
    
    <div id="button_indicator">
        <div id="tank_indicator" class="tank indicator"></div>
        <div id="production_indicator" class="production indicator"></div>
        <div id="tower_indicator" class="tower indicator"></div>
    </div>
    
    <div id="playingfield"></div>
</body>
</html>